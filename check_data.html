<!DOCTYPE html>
<html>
<head>
    <title>RiftLens Data Checker</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0e27;
            color: #00ffff;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            text-shadow: 0 0 10px #00ffff;
        }
        .section {
            background: #1a1f3a;
            border: 2px solid #00ffff40;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #00ff0020;
            border: 1px solid #00ff00;
            color: #00ff00;
        }
        .error {
            background: #ff000020;
            border: 1px solid #ff0000;
            color: #ff0000;
        }
        .warning {
            background: #ffaa0020;
            border: 1px solid #ffaa00;
            color: #ffaa00;
        }
        pre {
            background: #0a0e27;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #00ffff;
            color: #0a0e27;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            margin: 10px 5px;
        }
        button:hover {
            background: #00ffff80;
        }
        input {
            background: #1a1f3a;
            border: 2px solid #00ffff40;
            color: #00ffff;
            padding: 10px;
            font-size: 16px;
            border-radius: 4px;
            width: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç RiftLens Data Checker</h1>
        
        <div class="section">
            <h2>Step 1: Enter API URL</h2>
            <input type="text" id="apiUrl" placeholder="https://your-api-gateway-url.amazonaws.com/prod/report" />
            <button onclick="checkAPI()">Test API Connection</button>
            <div id="apiStatus"></div>
        </div>

        <div class="section">
            <h2>Step 2: Enter Player ID</h2>
            <input type="text" id="playerId" placeholder="Player PUUID or ID" />
            <button onclick="fetchPlayerData()">Fetch Player Data</button>
            <div id="fetchStatus"></div>
        </div>

        <div class="section">
            <h2>Step 3: Data Analysis</h2>
            <div id="analysis"></div>
        </div>

        <div class="section">
            <h2>Step 4: Match Details</h2>
            <button onclick="checkFirstMatch()">Check First Match</button>
            <button onclick="checkAllMatches()">Check All Matches</button>
            <div id="matchDetails"></div>
        </div>

        <div class="section">
            <h2>Raw Data (for debugging)</h2>
            <button onclick="showRawData()">Show Raw Data</button>
            <pre id="rawData" style="display:none;"></pre>
        </div>
    </div>

    <script>
        let playerData = null;

        async function checkAPI() {
            const apiUrl = document.getElementById('apiUrl').value;
            const statusDiv = document.getElementById('apiStatus');
            
            if (!apiUrl) {
                statusDiv.innerHTML = '<div class="error">‚ùå Please enter API URL</div>';
                return;
            }

            statusDiv.innerHTML = '<div class="warning">‚è≥ Testing connection...</div>';

            try {
                const response = await fetch(apiUrl);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="success">‚úÖ API is reachable!</div>';
                } else {
                    statusDiv.innerHTML = `<div class="error">‚ùå API returned status: ${response.status}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå Connection failed: ${error.message}</div>`;
            }
        }

        async function fetchPlayerData() {
            const apiUrl = document.getElementById('apiUrl').value;
            const playerId = document.getElementById('playerId').value;
            const statusDiv = document.getElementById('fetchStatus');

            if (!apiUrl || !playerId) {
                statusDiv.innerHTML = '<div class="error">‚ùå Please enter both API URL and Player ID</div>';
                return;
            }

            statusDiv.innerHTML = '<div class="warning">‚è≥ Fetching player data...</div>';

            try {
                const url = `${apiUrl}?playerID=${playerId}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    statusDiv.innerHTML = `<div class="error">‚ùå Failed to fetch: ${response.status}</div>`;
                    return;
                }

                playerData = await response.json();
                statusDiv.innerHTML = '<div class="success">‚úÖ Player data loaded!</div>';
                analyzeData();
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function analyzeData() {
            const analysisDiv = document.getElementById('analysis');
            
            if (!playerData) {
                analysisDiv.innerHTML = '<div class="error">‚ùå No data to analyze</div>';
                return;
            }

            let html = '';

            // Check basic structure
            html += '<h3>Basic Structure</h3>';
            html += `<div class="status ${playerData.PlayerID ? 'success' : 'error'}">`;
            html += `PlayerID: ${playerData.PlayerID ? '‚úÖ Present' : '‚ùå Missing'}</div>`;
            
            html += `<div class="status ${playerData.matchHistory ? 'success' : 'error'}">`;
            html += `matchHistory: ${playerData.matchHistory ? '‚úÖ Present' : '‚ùå Missing'}</div>`;

            if (playerData.matchHistory) {
                const matchCount = playerData.matchHistory.length;
                html += `<div class="status success">Total Matches: ${matchCount}</div>`;

                // Check participants in matches
                let matchesWithParticipants = 0;
                let matchesWithout = 0;
                let matchesWithWrongCount = 0;

                playerData.matchHistory.forEach((match, idx) => {
                    if (match.participants) {
                        if (match.participants.length === 10) {
                            matchesWithParticipants++;
                        } else {
                            matchesWithWrongCount++;
                        }
                    } else {
                        matchesWithout++;
                    }
                });

                html += '<h3>Participants Data</h3>';
                html += `<div class="status ${matchesWithParticipants === matchCount ? 'success' : 'warning'}">`;
                html += `‚úÖ Matches with 10 participants: ${matchesWithParticipants} / ${matchCount}</div>`;

                if (matchesWithout > 0) {
                    html += `<div class="status error">‚ùå Matches without participants: ${matchesWithout}</div>`;
                }

                if (matchesWithWrongCount > 0) {
                    html += `<div class="status warning">‚ö†Ô∏è Matches with wrong participant count: ${matchesWithWrongCount}</div>`;
                }

                // Recommendation
                if (matchesWithParticipants === matchCount) {
                    html += '<div class="status success">üéâ All matches have complete data! The issue might be in the frontend.</div>';
                } else if (matchesWithout > 0) {
                    html += '<div class="status error">üí° You need to run data_enrichment_updater.py to add participants data.</div>';
                } else {
                    html += '<div class="status warning">üí° Some matches have incomplete data. Consider re-fetching.</div>';
                }
            }

            analysisDiv.innerHTML = html;
        }

        function checkFirstMatch() {
            const detailsDiv = document.getElementById('matchDetails');
            
            if (!playerData || !playerData.matchHistory || playerData.matchHistory.length === 0) {
                detailsDiv.innerHTML = '<div class="error">‚ùå No match data available</div>';
                return;
            }

            const match = playerData.matchHistory[0];
            let html = '<h3>First Match Details</h3>';
            
            html += `<div class="status">Match ID: ${match.matchId || 'N/A'}</div>`;
            html += `<div class="status">Champion: ${match.championName || 'N/A'}</div>`;
            html += `<div class="status">KDA: ${match.kills}/${match.deaths}/${match.assists}</div>`;
            
            html += `<div class="status ${match.participants ? 'success' : 'error'}">`;
            html += `Has participants: ${match.participants ? '‚úÖ Yes' : '‚ùå No'}</div>`;

            if (match.participants) {
                html += `<div class="status ${match.participants.length === 10 ? 'success' : 'warning'}">`;
                html += `Participants count: ${match.participants.length} ${match.participants.length === 10 ? '‚úÖ' : '‚ö†Ô∏è'}</div>`;

                html += '<h4>Participants:</h4><pre>';
                match.participants.forEach((p, idx) => {
                    html += `${idx + 1}. ${p.championName} (Team ${p.teamId}) - ${p.kills}/${p.deaths}/${p.assists}\n`;
                });
                html += '</pre>';
            } else {
                html += '<div class="error">‚ùå This match needs to be enriched with participants data</div>';
                html += '<div class="warning">Run: python data_enrichment_updater.py</div>';
            }

            detailsDiv.innerHTML = html;
        }

        function checkAllMatches() {
            const detailsDiv = document.getElementById('matchDetails');
            
            if (!playerData || !playerData.matchHistory) {
                detailsDiv.innerHTML = '<div class="error">‚ùå No match data available</div>';
                return;
            }

            let html = '<h3>All Matches Summary</h3>';
            html += '<table style="width:100%; border-collapse: collapse;">';
            html += '<tr style="border-bottom: 2px solid #00ffff40;"><th>#</th><th>Match ID</th><th>Champion</th><th>Participants</th><th>Status</th></tr>';

            playerData.matchHistory.forEach((match, idx) => {
                const hasParticipants = match.participants && match.participants.length === 10;
                const statusClass = hasParticipants ? 'success' : 'error';
                const statusText = hasParticipants ? '‚úÖ Complete' : '‚ùå Missing';
                
                html += `<tr style="border-bottom: 1px solid #00ffff20;">`;
                html += `<td>${idx + 1}</td>`;
                html += `<td>${match.matchId || 'N/A'}</td>`;
                html += `<td>${match.championName || 'N/A'}</td>`;
                html += `<td>${match.participants ? match.participants.length : 0}</td>`;
                html += `<td class="${statusClass}">${statusText}</td>`;
                html += `</tr>`;
            });

            html += '</table>';
            detailsDiv.innerHTML = html;
        }

        function showRawData() {
            const rawDataPre = document.getElementById('rawData');
            
            if (rawDataPre.style.display === 'none') {
                rawDataPre.style.display = 'block';
                rawDataPre.textContent = JSON.stringify(playerData, null, 2);
            } else {
                rawDataPre.style.display = 'none';
            }
        }
    </script>
</body>
</html>
